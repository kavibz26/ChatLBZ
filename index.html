<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatLBZ Ultra AI ğŸš€</title>
    <style>
        :root { --primary: #0044ff; --bg: #72edda; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        #header { background: white; padding: 12px 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 2px solid #ddd; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 10; }
        
        #chatbox { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        
        .welcome-msg { 
            text-align: center; color: var(--primary); font-size: 1.3rem; 
            font-weight: bold; margin: 20px auto; background: rgba(255,255,255,0.9);
            padding: 15px 25px; border-radius: 25px; align-self: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .msg { padding: 14px 18px; border-radius: 20px; max-width: 85%; font-size: 16px; line-height: 1.5; box-shadow: 0 2px 8px rgba(0,0,0,0.05); white-space: pre-wrap; word-wrap: break-word; }
        .user { align-self: flex-end; background: var(--primary); color: white; border-bottom-right-radius: 2px; }
        .bot { align-self: flex-start; background: white; color: #333; border: 1px solid #ddd; border-bottom-left-radius: 2px; }
        
        .ai-media { width: 100%; max-width: 320px; border-radius: 15px; margin-top: 10px; display: block; border: 3px solid var(--primary); }

        #input-area { background: white; padding: 15px 20px; display: flex; gap: 12px; border-top: 1px solid #ddd; }
        input { flex: 1; padding: 14px 22px; border-radius: 30px; border: 2px solid #eee; outline: none; font-size: 16px; }
        
        .btn-send { background: var(--primary); color: white; padding: 12px 24px; border-radius: 30px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-send:disabled { background: #ccc; }

        .typing { font-style: italic; color: #777; font-size: 14px; margin-bottom: 10px; display: none; padding: 0 20px; }
    </style>
</head>
<body>

<div id="header">
    <div style="display: flex; align-items: center; gap: 12px;">
        <div style="width:40px; height:40px; background:var(--primary); border-radius:50%; color:white; display:flex; justify-content:center; align-items:center; font-weight:bold;">LBZ</div>
        <h2 style="margin:0; font-size: 1.1rem; color: var(--primary);">ChatLBZ Genius</h2>
    </div>
    <button onclick="localStorage.clear(); location.reload();" style="background:#ff4d4d; color:white; border:none; border-radius:10px; padding:8px 15px; cursor:pointer;">ğŸ—‘ï¸ × ×§×” ×”×›×œ</button>
</div>

<div id="chatbox">
    <div class="welcome-msg">×”×™×™ ×× ×™ ChatLBZ ××™×š ××•×›×œ ×œ×¢×–×•×¨ ×œ×š ×”×™×•×</div>
</div>

<div id="typing-indicator" class="typing">ChatLBZ ×—×•×©×‘...</div>

<div id="input-area">
    <input type="text" id="userInput" placeholder="×©××œ ××•×ª×™ ××©×”×• ××• ×‘×§×© ×ª××•× ×”..." onkeypress="if(event.key==='Enter') startChat()">
    <button id="sendBtn" class="btn-send" onclick="startChat()">×©×œ×— ğŸš€</button>
</div>

<script>
    // ×©×™× ×œ×‘: ×”×“×‘×§ ××ª ×”××¤×ª×— ×©××ª×—×™×œ ×‘-AIza ×‘×ª×•×š ×”××¨×›××•×ª ×‘×©×•×¨×” ×œ××˜×”
    const API_KEY = "AIzaSyDedL6iFecR4Mf-cLxOh4l2H360JaR-gFc"; 

    const chatbox = document.getElementById('chatbox');
    const typingIndicator = document.getElementById('typing-indicator');
    const sendBtn = document.getElementById('sendBtn');

    function addMsg(text, side, html = "") {
        const div = document.createElement('div');
        div.className = `msg ${side}`;
        div.innerHTML = (side === 'bot' ? "<b>ChatLBZ:</b> " : "") + text + html;
        chatbox.appendChild(div);
        chatbox.scrollTop = chatbox.scrollHeight;
    }

    async function startChat() {
        const input = document.getElementById('userInput');
        const text = input.value.trim();
        
        if (!text || sendBtn.disabled) return;

        addMsg(text, 'user');
        input.value = "";
        
        // ×¤×§×•×“×•×ª ××“×™×” ××”×™×¨×•×ª
        if (text.includes("×ª××•× ×” ×©×œ")) {
            let q = text.replace("×ª××•× ×” ×©×œ", "").trim();
            addMsg("××™×™×¦×¨ ×œ×š ×ª××•× ×” ×©×œ " + (q || "××©×”×• ×™×¤×”") + "...", 'bot', `<img src="https://loremflickr.com/640/480/${q || 'art'}" class="ai-media">`);
            return;
        }
        
        if (text.includes("×¡×¨×˜×•×Ÿ ×©×œ")) {
            let q = text.replace("×¡×¨×˜×•×Ÿ ×©×œ", "").trim();
            addMsg("××¦××ª×™ ×¡×¨×˜×•×Ÿ ×¢×‘×•×¨×š:", 'bot', `<iframe class="ai-media" style="height:220px;" src="https://www.youtube.com/embed?listType=search&list=${q}" frameborder="0" allowfullscreen></iframe>`);
            return;
        }

        typingIndicator.style.display = "block";
        sendBtn.disabled = true;

        try {
            // ×”×ª×™×§×•×Ÿ: ×©×™××•×© ×‘×’×¨×¡×ª v1 ×”×™×¦×™×‘×”
            const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: "××ª×” ChatLBZ, ×¢×•×–×¨ ××™×©×™ ×—×›× ×©× ×‘× ×” ×¢×œ ×™×“×™ Kavibz26. ×¢× ×” ×‘×¢×‘×¨×™×ª: " + text }] }]
                })
            });

            const data = await response.json();
            
            if (data.error) {
                addMsg("×©×’×™××” ××’×•×’×œ: " + data.error.message, 'bot');
            } else if (data.candidates && data.candidates[0].content.parts[0].text) {
                const aiReply = data.candidates[0].content.parts[0].text;
                addMsg(aiReply, 'bot');
            } else {
                throw new Error("No response body");
            }

        } catch (error) {
            addMsg("××•×¤×¡! ×™×© ×‘×¢×™×” ×‘×—×™×‘×•×¨ ×œ××•×— ×©×œ×™. ×•×•×“× ×©×”××¤×ª×— ×ª×§×™×Ÿ ×•× ×¡×” ×©×•×‘.", 'bot');
        } finally {
            typingIndicator.style.display = "none";
            sendBtn.disabled = false;
        }
    }
</script>

</body>
</html>
